# リアルタイムカメラ処理システム

OpenCVとPyTorchを使用したリアルタイムビデオ処理のためのクライアント・サーバーアプリケーションです。クライアントのカメラからビデオを取得し、サーバーでGPUを使って処理を行い、処理済みのフレームをクライアントに表示します。

## 主な機能

- リアルタイムでのビデオ取得と処理
- 分散処理のためのクライアント・サーバーアーキテクチャ
- PyTorchによるGPUアクセラレーション対応
- 二値化および膨張処理
- msgpackを使用した効率的なフレーム転送
- 低遅延設定のTCPソケット通信

## 必要条件

- Python 3.x
- OpenCV (`cv2`)
- PyTorch
- NumPy
- msgpack
- msgpack-numpy

必要なパッケージは以下のコマンドでインストールできます：

```bash
pip install opencv-python torch numpy msgpack msgpack-numpy
```

## 使用方法

### サーバーの起動

1. サーバースクリプトを実行：
```bash
python server.py
```
デフォルトでポート9999でリッスンを開始します。

### クライアントの実行

1. `client.py`内の`server_host`をお使いのサーバーのIPアドレスに更新
2. クライアントスクリプトを実行：
```bash
python client.py
```

クライアントはサーバーに接続し、カメラフレームの送信を開始します。処理済みのフレームはウィンドウに表示されます。'q'キーを押すと終了します。

## システム構成

### サーバー側
- クライアントからの接続を待ち受け
- PyTorchとOpenCVを使用してフレームを処理
- スレッディングによる複数クライアント接続対応
- 受信フレームの二値化および膨張処理
- 利用可能な場合はGPUアクセラレーションを使用

### クライアント側
- ローカルカメラからビデオを取得
- フレームをサーバーに送信して処理
- 処理済みフレームの受信と表示
- フレームのキューイングと同期管理

## 設定

### サーバー設定
- デフォルトホスト：`0.0.0.0`（全インターフェース）
- デフォルトポート：`9999`
- 処理パラメータは`ImageProcessor`クラスで変更可能

### クライアント設定
- デフォルトサーバーホスト：`100.91.37.49`
- デフォルトポート：`9999`
- カメラ解像度：640x480
- フレームキューサイズ：2

## パフォーマンスに関する考慮事項

- 最小限の遅延のためにTCP_NODELAYを使用
- メモリオーバーフロー防止のためのフレームキューイング
- 最適なパフォーマンスのために640x480にリサイズ
- 効率的なバイナリシリアライゼーションにmsgpackを使用